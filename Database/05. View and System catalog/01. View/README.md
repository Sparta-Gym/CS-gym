# 1. 뷰

<!--ts-->

- [1. 뷰](#1-뷰)
  - [1. 뷰와 시스템 카탈로그](#1-뷰와-시스템-카탈로그)
  - [2. 뷰의 개요](#2-뷰의-개요)
  - [3. 스냅샷(snapshot)](#3-스냅샷snapshot)
  - [4. 뷰의 정의와 장점(쓸 이유가 생기는 컨텍스트)](#4-뷰의-정의와-장점쓸-이유가-생기는-컨텍스트)
  - [5. 뷰의 갱신](#5-뷰의-갱신)

<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: sungminyou, at: 2022년 9월  1일 목요일 12시 20분 42초 KST -->

<!--te-->

## 1. 뷰와 시스템 카탈로그

- 관계 데이터베이스 시스템의 뷰(view)는 다른 릴레이션으로부터 유도된 릴레이션(derived relation)으로서 ANSI / SPARC 3단계 아키텍처의 외부 뷰와 다름
- 뷰는 관계 데이터베이스 시스템에서 데이터베이스의 보안 메커니즘으로서, 복잡한 쿼리를 간단하게 표현하는 수단이고 데이터 독립성을 높이기 위해서 사용됨, SQL문으로 정의된 가상의 릴레이션(virtual relation)
- 시스템 카탈로그는 시스탬 내의 객체(기본 릴레이션, 뷰, 인덱스, 사용자, 접근 권한 등)에 관한 정보를 포함하는 시스템의 메타데이터
- 시스템 카탈로그를 적절히 활용하면 원하는 릴레이션을 데이터베이스에서 찾고, 그 릴레이션에 어떤 애트리뷰트들이 들어 있으며, 각 애트리뷰트의 데이터 타입은 무엇인가 등을 쉽게 파악할 수 있음
- 뷰의 정의는 디스크에 저장되는게 아닌 카탈로그에 저장된다

## 2. 뷰의 개요

![1](https://user-images.githubusercontent.com/48282185/187824817-97823d1c-cfe5-4ba3-8c0c-878b3823e3dd.png)

- ANSI / SPARC 3단계 아키텍처의 외부 뷰는 특정 사용자가 보는 데이터베이스의 구조이고 여기서 말하는 뷰와는 다른 개념이다
- 관계 데이터베이스에서 뷰는 한 사용자의 전체 외부 뷰 대신에 하나의 가상 릴레이션(virtual relation)을 의미
- 뷰는 기존의 기본 릴레이션(base relation, 실제 릴레이션)에 대한 SELECT문의 형태로 정의됨
- 뷰를 이용해서 다른 뷰를 정의할 수도 있다, 여러 단계가 있음
- 사용자는 여러 개의 릴레이션과 뷰를 사용할 수 있음
- 뷰는 릴레이션으로부터 데이터를 검색하거나 갱신할 수 있는 동적인 창(dynamic window)의 역할
  - 뷰는 고정이지만 얻어지는 데이터는 데이터의 갱신에 의해 변화할 수 있다는 의미에서 동적이다
- 뷰는 저장되는 데이터가 아니기 때문에 연산할 때마다 불려지기에 시간이 걸리는 단점이 있다

## 3. 스냅샷(snapshot)

- 어느 시점에 SELECT문의 결과를 기본 릴레이션의 형태로 저장해 놓은 것
- 스냅샷은 사진을 찍은 것과 같아서 스냅샷을 정의하는 시점의 기본 릴레이션의 내용이 스냅샷에 반영됨
- 어떤 시점의 조직체의 현황 등이 스냅샷으로 정의될 수 있음
- 정적인 데이터

## 4. 뷰의 정의와 장점(쓸 이유가 생기는 컨텍스트)

- 뷰를 정의하는 SQL 구문

  ```sql
  CREATE VIEW 뷰이름 [(애트리뷰트들)]
  AS SELECT 문
  [WITH CHECK OPTION]; # 무결성 제약 조건
  ```

  - 뷰의 이름 다음에 애트리뷰트들을 생략하면 뷰를 정의하는데 사용된 SELECT문에서 뽑은 애트리뷰트들이 뷰에 포함됨
  - 뷰를 정의하는 SELECT절에서 산술식 또는 집단 함수가 사용된 애트리뷰트가 있는 경우, 뷰의 정의에 조인이 포함되어 있고 두 개 이상의 다른 릴레이션으로부터 가져운 애트리뷰트들의 이름이 같아서 뷰에서 두 개 이상의 애트리뷰트의 이름이 같게 되는 경우에는 뷰를 정의할 때 모든 애트리뷰트들의 이름을 지정해야함

- 뷰를 사용하여 데이터를 접근할 때 DBMS에서 거치는 과정
  - 시스템 카탈로그로부터 뷰의 정의, 즉 SELECT문을 검색
  - 기본 릴레이션에 대한 뷰의 접근 권한을 검사
  - 뷰에 대한 쿼리를 기본 릴레이션에 대한 쿼리로 변경
- 뷰의 장점

  - 뷰는 복잡한 쿼리를 간단하게 표현할 수 있게 함, alias 역할
  - 뷰는 데이터 무결성을 보장하는데 활용됨

    - 뷰를 통해서 기본 릴레이션에 update, insert, delete를 할 수 있다
    - 기본적으로 뷰를 통해 튜플을 추가하거나 수정할 때 튜플이 뷰를 정의하는 SELECT문의 WHERE절 기준에 맞지 않으면 뷰의 내용에서 사라짐
    - 뷰를 정의할 때 WITH CHECK OPTION을 명시했다고 가정하면 뷰의 정의에 맞지 않는 갱신 연산은 수행되지 않음
    - 예시

      - 부서번호가 3번인 직원들을 모아놓은 뷰를 정의

      ```sql
      CREATE VIEW EMP_DNO_3 (ENO, ENAME, TITLE)
      AS SELECT EMPNO, EMPNAME, TITLE
      		 FROM EMPLOYEE
      		WHERE DNO = 3
      		WITH CHECK OPTION;
      ```

      - 이 부서의 한 직원이 부서이동을 해서 번호를 바꿔줘야함

      ```sql
      UPDATE EMP_DNO_3
      SET DNO = 2
      WHERE ENO = 3427;
      ```

      - 사원번호 3427은 EMP_DNO_3에서 사라지고 3과는 더 이상 관련 없는 튜플
      - 실제 릴레이션에는 업데이트가 정상적으로 되겠지만 뷰에서는 UPDATE 했지만 DELETE한 효과가 난다
      - 3번 부서와는 관련이 없는 연산을 하고 있다, 의미적으로 이상하다, 이럴 때 막을 수 있는 수단이 WITH CHECK OPTION으로 갱신 연산들의 조건이 뷰의 조건과 맞지 않은 것들은 무시한다

    - 뷰는 데이터의 독립성을 제공함
      - 데이터(기존 릴레이션)가 변경되더라도 의존하지 않고(독립적으로) 계속 쓸 수 있게해준다
      - 뷰는 데이터베이스의 구조가 바뀌어도 기존의 쿼리(응용 프로그램)를 다시 작성할 필요성을 줄이는데 사용될 수 있음
      - 예시로 EMPLOYEE 릴레이션이 두 개의 릴레이션 EMP1과 EMP2로 분해할 필요가 있을 때 응용프로그램에서 기존의 EMPLOYEE 릴레이션에 날리던 쿼리들이 동작하지 않기 때문에 EMP1, 2에 대한 쿼리로 변경해야한다 이 때 EMPLOYEE라는 뷰를 만들고 분해 전의 릴레이션으로 정의한다면, 이 쿼리들을 일일이 바꿔줄 필요가 없어진다
    - 뷰는 데이터 보안 기능을 제공함
      - 데이터베이스의 접근 권한은 크게 두 가지로 분류할 수 있다
        - static
          - 특정 애트리뷰트에 대한 접근 권한으로 모든 데이터가 이 권한을 따른다
        - dynamic
          - 특정 조건을 만족하는(동적으로 변하는) 데이터들만 이 권한을 따른다
          - SQL문을 실행해봐야 만족하는지 안하는지 알 수 있다
          - content based access control
          - static에 비해 발전된 방법이며 뷰에 의해 구현될 수 있다
          - 뷰도 다이나믹한 데이터이기 때문에 어떤 사용자에게 어떤 뷰에 대한 접근권한을 주게되면 자연스럽게 이것은 동적 권한부여가 된다
      - 뷰는 뷰의 원본이 되는 기본 릴레이션에 직접 접근할 수 있는 권한을 부여하지 않고 뷰를 통해 데이터를 접근하도록 하기 때문에 보안 매커니즘으로 사용할 수 있음
      - 뷰는 일반적으로 기본 릴레이션의 일부 애트리뷰트들 또는 일부 튜플들을 검색하는 SELECT문으로 정의되므로 뷰를 통해서 기본 릴레이션을 접근하면 기본 릴레이션의 일부만 검색할 수 있음
      - 예시로 EMPLOYEE 릴레이션의 SALARY 애트리뷰트는 숨기고 나머지 애트리뷰트들은 모든 사용자가 접근할 수 있도록 하려면 모든 애트리뷰트를 포함하는 뷰를 정의하고, 사용자에게 뷰에 대한 SELECT 권한을 허가하면 됨
    - 동일한 데이터에 대한 여러 가지 뷰를 제공함
      - 뷰는 사용자들의 그룹이 각자 특정한 기준에 따라 데이터를 접근하도록 함

## 5. 뷰의 갱신

- 기본 릴레이션의 연산들을 모두 제공하는 것이 뷰의 기본 원칙, 이게 기본 릴레이션인지 뷰인지 사용자는 알 수 없게 하는 것이 목표
- 뷰가 릴레이션에 대한 기본 키를 포함해야만 삽입 가능 because 무결성 제약조건, 나머지 삽입 안되는 애트리뷰트들은 null값으로 채우면 됨
- 갱신 경우의 수
  - 한 릴레이션 위에서 정의된 뷰에 대한 갱신
    - 제약 조건에 위배되지만 않는 다면 가능
  - 두 개 이상의 릴레이션 위에서 정의된 뷰에 대한 갱신
    - 현재 대부분의 DBMS는 이 경우를 허용하지 않음
    - 기능 추가에 들어가는 노력대비 사용량이 떨어짐
  - 집단 함수 등을 포함한 뷰에 대한 갱신
    - 현재 대부분의 DBMS는 이 경우를 허용하지 않음
    - 이론적으로는 가능하나 컨텍스트 측면에서 보면 넌센스하다
- 정리

  - 갱신이 불가능한 뷰
    - 한 릴레이션 위에서 정의되었으나 그 릴레이션의 기본 키가 포함되지 않은 뷰 → 무결성 제약조건 위반
    - 기본 릴레이션의 애트리뷰트들 중에서 뷰에 포함되지 않은 애트리뷰트에 대해 NOT NULL이 지정되어 있을 때 → 무결성 제약조건 위반
    - 집단 함수가 포함된 뷰
    - 조인으로 정의된 뷰(두 개 이상의 릴레이션 위에서 정의된 뷰에 대한 갱신)
  - 갱신 가능성 기준에 따른 뷰들의 유형

    ![2](https://user-images.githubusercontent.com/48282185/187824809-3d28984a-ef08-48b9-a213-2188accac1ba.png)

> 출처
>
> - 이화여대 용환승 교수님 강의
> - 홍의경 저, MS SQL Server 기반 데이터베이스 배움터, 생능출판사, 2012년,
> - 이석호 저, 데이터베이스 시스템, 정익사, 2009.
> - A. Silberschatz, H. Korth, S. Sudarshan, "Database System Concepts," 6th Ed., McGraw-Hill, 2010.
> - Elmasri and Navathe, “ Fundamentals of Database Systems”, 6th ed. Addison-Wesley, 2010.
> - C.J.Date, “An Introduction to Database Systems (8th Edition)”, Addison-Wesley, 2003.
> - Won Kim, "Modern Database Systems," ACM Press, 1994
